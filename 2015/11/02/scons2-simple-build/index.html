
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>lyyyuna 的小花园: SCons 用户指南第二章-简单编译</title>
    
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  table {
      border-collapse: collapse;
      width: 100%;
  }
  th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
  }
  th {
      background-color: #f2f2f2;
  }
  
  .icp {
    margin: 10px 0;
    width: 100%;
    height: 36px;
    white-space: pre;
    text-align: center;
    color: gray;
    z-index: 1000;
  }
  body {
    padding: 0;
    margin: 0;
    font-size: 112.5%;
    font-family: serif;
  }
  @media print {
    img {page-break-inside: avoid;}
    div.nosplit {page-break-inside: avoid;}
  }
  img {
    width: 100%;
  }
  img.center {
    display: block;
    margin: 0 auto;
  }
  img.resizable {
    max-width: 100%;
    height: auto;
  }
  p code, li code {
    font-size: 14px;
    word-wrap: break-word;
    padding: 2px 4px;
    border-radius: 4px;
    margin: 0 2px;
    color: #1e6bb8;
    background-color: rgba(27,31,35,.05);
    font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;
    word-break: break-all;
  }
  strong {
    font-weight: bold;
    color: darkred;
  }
  .pad {
    padding-top: 1em;
    padding-bottom: 1em;
  }
  a.anchor, a.back, a.footnote {
    color: black !important;
    text-decoration: none !important;
  }
  a.back {
    font-size: 50%;
  }
  @media print {
    a.back {display: none;}
  }
  .header {
    height: 1.25em;
    background-color: #dff;
    margin: 0;
    padding: 0.1em 0.1em 0.2em;
    border-top: 1px solid black;
    border-bottom: 1px solid #8ff;
  }
  .header h3 {
    margin: 0;
    padding: 0 2em;
    display: inline-block;
    padding-right: 2em;
    font-style: italic;
    font-size: 90%;
  }
  .rss {
    float: right;
    padding-top: 0.2em;
    padding-right: 2em;
    display: none;
  }
  .toc {
    margin-top: 2em;
  }
  .toc-title {
    font-family: cursive, serif;
    font-style: italic;
    font-size: 300%;
    line-height: 83%;
  }
  .toc-subtitle {
    display: block;
    margin-bottom: 1em;
    font-size: 83%;
  }
  @media only screen and (max-width: 550px) { .toc-subtitle { display: none; } }
  .header h3 a {
    color: black;
  }
  .header h4 {
    margin: 0;
    padding: 0;
    display: inline-block;
    font-weight: normal;
    font-size: 83%;
  }
  @media only screen and (max-width: 550px) { .header h4 { display: none; } }
  .main {
    padding: 0 2em;
  }
  @media only screen and (max-width: 479px) { .article { font-size: 120%; } }
  .article h1 {
    text-align: center;
    font-size: 200%;
  }
  .copyright {
    font-size: 83%;
  }
  .subtitle {
      font-size: 65%;
  }
  .normal {
    text-align: center;
    font-size: medium;
    font-weight: normal;
  }
  .when {
    text-align: center;
    font-size: 100%;
    margin: 0;
    padding: 0;
  }
  .when p {
    margin: 0;
    padding: 0;
  }
  .article h2 {
    font-size: 125%;
    padding-top: 0.25em;
  }
  .article h3 {
    font-size: 100%;
  }
  .footer {
    margin-top: 10px;
    font-size: 83%;
    font-family: sans-serif;
  }
  .comments {
    margin-top: 2em;
    background-color: #ffe;
    border-top: 1px solid #aa4;
    border-left: 1px solid #aa4;
    border-right: 1px solid #aa4;
  }
  .comments-header {
    padding: 0 5px 0 5px;
  }
  .comments-header p {
    padding: 0;
    margin: 3px 0 0 0;
  }
  .comments-body {
    padding: 5px 5px 5px 5px;
  }
  #plus-comments {
    border-bottom: 1px dotted #ccc;
  }
  .plus-comment {
    width: 100%;
    font-size: 14px;
    border-top: 1px dotted #ccc;
  }
  .me {
    background-color: #eec;
  }
  .plus-comment ul {
    margin: 0;
    padding: 0;
    list-style: none;
    width: 100%;
    display: inline-block;
  }
  .comment-when {
    color:#999;
    width:auto;
    padding:0 5px;
  }
  .old {
    font-size: 83%;
  }
  .plus-comment ul li {
    display: inline-block;
    vertical-align: top;
    margin-top: 5px;
    margin-bottom: 5px;
    padding: 0;
  }
  .plus-icon {
    width: 45px;
  }
  .plus-img {
    float: left;
    margin: 4px 4px 4px 4px;
    width: 32px;
    height: 32px;
  }
  .plus-comment p {
    margin: 0;
    padding: 0;
  }
  .plus-clear {
    clear: left;
  }
  .toc-when {
    font-size: 83%;
    color: #999;
  }
  .toc {
    list-style: none;
  }
  .toc li {
    margin-bottom: 0.5em;
  }
  .toc-head {
    margin-bottom: 1em !important;
    font-size: 117%;
  }
  .toc-summary {
    margin-left: 2em;
  }
  .favorite {
    font-weight: bold;
  }
  .article p, .article ol {
    line-height: 144%;
  }
  sup, sub {
    vertical-align: baseline;
    position: relative;
    font-size: 83%;
  }
  sup {
    bottom: 1ex;
  }
  sub {
    top: 0.8ex;
  }

  .main {
    position: relative;
    margin: 0 auto;
    padding: 0;
    width: 900px;
  }
  @media only screen and (min-width: 768px) and (max-width: 959px) { .main { width: 708px; } }
  @media only screen and (min-width: 640px) and (max-width: 767px) { .main { width: 580px; } }
  @media only screen and (min-width: 480px) and (max-width: 639px) { .main { width: 420px; } }
  @media only screen and (max-width: 479px) { .main { width: 90%; } }

  .pager {display: flex;margin-bottom: 20px}
  .pager:last-of-type {margin-top: 50px;}

  .pager span, .pager   a {flex: 50%;line-height:50px;}
  .pager a {color: var(--pager-fg); padding: 0 10px; border-radius: 4px; border: 1px solid #ccc; text-decoration: none; }
  .pager a:hover{background: var(--pager-hover); border-color: #bbb;}
  .pager .prev {margin-right: 10px;}
  .pager a.prev:not(:empty):before{content: '« '}
  .pager a.next:not(:empty):after{content: ' »'}
  .pager .next {text-align: right;margin-left: 10px}

</style>
<link rel="stylesheet" href="/libs/highlight/styles/a11y-dark.min.css">
<script src="/libs/highlight/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
</head>
<body>
    
<div class="header">
  <h3><a href="/">lyyyuna 的小花园</a></h3>
  <h4>动静中之动,
    by <a href="https://www.lyyyuna.com/about/" rel="author">lyyyuna</a> </h4>
  <a class="rss" href="https://www.lyyyuna.com/feed.atom">RSS</a>
</div>

<div class="main">
  <div class="article">
    <h1>SCons 用户指南第二章-简单编译
    
    <div class="subtitle">(<i><a href="/series/SCons 用户指南/">SCons 用户指南</a>, Part 2</i>)</div>
    </h1>
    <div class="normal">
      <div class="when">
        
          发表于 2015-11
          
      </div>
    </div>
    <p>在本章中，你将会看到使用 SCons 作配置的简单编译的例子。这些例子表现了使用 SCons 作为不同语言不同系统编译构建工具是非常简单的。</p>
<h2>2.1 编译简单的 C/C++ 程序</h2>
<p>以下是著名的 C 语言 &quot;Hello, World!&quot;：</p>
<pre><code>int
main()
{
    printf(&quot;Hello, world!\n&quot;);
}
</code></pre>
<p>接下来是如何使用 SCons 进行编译。只要在名为 SConstruct 的文件中输入：</p>
<pre><code>Program('hello.c')
</code></pre>
<p>这个最小的配置文件告诉 SCons 两个信息：你想编译成什么（一个可执行的程序），和你的源文件（hello.c）。Program 是一个 builder_method，这是一个 Python 的调用，用来告诉 SCons 你想生成一个可执行的程序。</p>
<p>好了。现在使用 scons 命令来编译程序。在一个 POSIX 兼容的系统上，比如 Linux/UNIX，你将会看到如下的输出：</p>
<pre><code>% scons
scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
cc -o hello.o -c hello.c
cc -o hello hello.o
scons: done building targets.
</code></pre>
<p>在使用 Microsoft Visual C++ 编译器的 Windows 系统上，你会看到如下的输出：</p>
<pre><code>C:\&gt;scons
scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
cl /Fohello.obj /c hello.c /nologo
link /nologo /OUT:hello.exe hello.obj
embedManifestExeCheck(target, source, env)
scons: done building targets.
</code></pre>
<p>首先注意到，你只需要指出源文件的名字，SCons 就会正确推导出 object 和可执行文件的名字。</p>
<p>然后注意到，相同的 SConstruct 文件，不用修改就可以在不同系统生成正确的输出：在 POSIX 系统上生成 hello.o 和 hello，在 Windows 系统上生成 hello.obj 和 hello.exe。这是一个非常简单的例子，展示了 SCons 能够很容易地编写可移植的软件编译系统。</p>
<p>（注意到在本指南中，并不是每个例子都给出了 POSIX 和 Windows 的输出，然而除非特别声明，这些例子在每个系统上都应该是可工作的。）</p>
<h2>2.2 编译目标文件</h2>
<p>Program 编译方法只是 SCons 提供的众多编译方法的一种，他们可用来编译成各种文件。其中另外一个就是 Object 编译方法，能使 SCons 从指定的源文件编译成相应的目标文件：</p>
<pre><code>Object('hello.c')
</code></pre>
<p>现在你只要运行 scons 命令编译程序，就能在 POSIX 系统上得到名为 hello.o 的目标文件：</p>
<pre><code>% scons
scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
cc -o hello.o -c hello.c
scons: done building targets.
</code></pre>
<p>在使用 Microsoft Visual C++ 编译器的 Windows 系统上，你会得到：</p>
<pre><code>C:\&gt;scons
scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
cl /Fohello.obj /c hello.c /nologo
scons: done building targets.
</code></pre>
<h2>2.3 简单 Java 编译</h2>
<p>SCons 也使得编译 Java 及其简单。然而不像 Program 和 Object 编译方法，Java编译方法需要你指定生成的 class 文件的目标路径，和你 .java 文件的源路径：</p>
<pre><code>Java('classes', 'src')
</code></pre>
<p>如果 src 目录只包含一个 hello.java 文件，那么使用 scons 命令的输出结果将是（POSIX）：</p>
<pre><code>% scons
scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
javac -d classes -sourcepath src src/hello.java
scons: done building targets.
</code></pre>
<p>我们将在第 26 章讲述更多关于 Java 编译的内容，包括 .jar 和其他类型文件。</p>
<h2>2.4 在编译之后清理</h2>
<p>当使用 SCons 编译完成之后，不需要特别的命令来清理。相反，你只需要 -c 或者 --clean 选项，SCons 就会自动清理相关的编译生成文件。如果在上面的例子之后，我们调用 scons -c 命令，在 POSIX 系统上就会输出：</p>
<pre><code>% scons
scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
cc -o hello.o -c hello.c
cc -o hello hello.o
scons: done building targets.
% scons -c
scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Cleaning targets ...
Removed hello.o
Removed hello
scons: done cleaning targets.
</code></pre>
<p>在 Windows 上就会输出：</p>
<pre><code>C:\&gt;scons
scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
cl /Fohello.obj /c hello.c /nologo
link /nologo /OUT:hello.exe hello.obj
embedManifestExeCheck(target, source, env)
scons: done building targets.
C:\&gt;scons -c
scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Cleaning targets ...
Removed hello.obj
Removed hello.exe
scons: done cleaning targets.
</code></pre>
<p>注意到 SCons 用 Cleaning targets ... 和 done cleaning targets 来告诉你清理过程。</p>
<h2>2.5 SConstruct 文件</h2>
<p>如果你曾经使用过类似 Make 的编译系统，你可能会想 SConstruct 文件是否等同于 Makefile 文件。是的，SConstruct 文件是 SCons 用来控制编译过程的。</p>
<h3>2.5.1 SConstruct 文件是 Python 脚本文件</h3>
<p>然而 SConstruct 文件和 Makefile 文件一个重要的区别就是：SConstruct 文件实际上就是一个 Python 脚本文件。如果你还不熟悉 Python，不要着急。本用户指南会介绍一下基本的 Python 语法来有效地使用 SCons。而且，Python 非常容易学习。</p>
<p>使用 Python 脚本语言的一方面就是你可以在 SConstruct 文件中使用 Python 的注释，那就是 '#'，该行之后的都会被忽略：</p>
<pre><code># Arrange to build the &quot;hello&quot; program.
Program('hello.c')    # &quot;hello.c&quot; is the source file.
</code></pre>
<p>你可以在本指南剩余部分看到，一个真正的脚本语言，可以使用极简单的方法来满足现实世界的复杂需求。</p>
<h3>2.5.2 SCons 函数是顺序无关的</h3>
<p>SConstruct 文件更像 Makefile 文件也是区别于普通 Python 脚本的重要一点就是，SCons 函数的调用顺序并不影响实际编译过程中目标文件的编译顺序。换句话说，当你调用 Program 编译方法（或者其他编译方法）时，你并不是告诉在此立即编译程序。相反，你只是告诉你需要编译的程序，举例来说，如果你想编译 hello.c，完全由 SCons 来决定何时编译程序。（我们将在第六章-依赖中学习 SCons 何时编译和重新编译）。</p>
<p>当 SCons 读入 SConstruct 文件和实际编译程序的时候， SCons 通过在输出的状态信息中反映出调用编译方法如 Program 和实际编译程序过程的区别。这能够反映出 SCons 到底是在执行 Python 语句还是在执行编译命令。</p>
<p>让我们来用一个例子说明这一点。Python 有一个 print 语句能够在将字符串打印在屏幕上。如果 print 语句放在 Program 编译方法之间：</p>
<pre><code>print &quot;Calling Program('hello.c')&quot;
Program('hello.c')
print &quot;Calling Program('goodbye.c')&quot;
Program('goodbye.c')
print &quot;Finished calling Program()&quot;
</code></pre>
<p>然后当我们调用 SCons 时，我们能够看到打印的 print 语句，指示出这些语句是何时执行的：</p>
<pre><code>% scons
scons: Reading SConscript files ...
Calling Program('hello.c')
Calling Program('goodbye.c')
Finished calling Program()
scons: done reading SConscript files.
scons: Building targets ...
cc -o goodbye.o -c goodbye.c
cc -o goodbye goodbye.o
cc -o hello.o -c hello.c
cc -o hello hello.o
scons: done building targets.
</code></pre>
<p>注意到尽管我们先调用了 Program('hello')，但是 goodbye 程序先被编译了，</p>
<h2>2.6 使 SCons 输出更简洁</h2>
<p>你已经看见了 SCons 在实际编译指令周围使用了一些信息来指示出它当前执行的动作：</p>
<pre><code>C:\&gt;scons
scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
cl /Fohello.obj /c hello.c /nologo
link /nologo /OUT:hello.exe hello.obj
embedManifestExeCheck(target, source, env)
scons: done building targets.
</code></pre>
<p>这些信息强调了 SCons 工作的顺序：所有的配置文件（大部分是 SConscript 文件）首先被读入和执行，然后是编译目标文件。除了其他好处，这些信息还帮助区分是读入配置错误还是编译过程中发生的错误。</p>
<p>一个显而易见的缺点是这些信息混淆了输出。幸运的是你可以使用 -Q 选项来取消它们：</p>
<pre><code>C:\&gt;scons -Q
cl /Fohello.obj /c hello.c /nologo
link /nologo /OUT:hello.exe hello.obj
embedManifestExeCheck(target, source, env)
</code></pre>
<p>因为本指南想注重于 SCons de 实际工作过程，我们将在剩余的例子中继续使用 -Q 选项来移除这些信息。</p>

  </div>

    
    <div class="pager">

      
        <a class="prev" href="/2015/10/17/scons1-building-and-installing-scons/">
          SCons 用户指南第一章-编译和安装 SCons
        </a>
      

      
        <a class="next" href="/2015/12/03/scons3-less-simple-things-to-do-with-builds/">
          SCons 用户指南第三章-让 SCons 编译更简单
        </a>
      

    </div>
    
  <div class="icp"> lyyyuna <a href="https://beian.miit.gov.cn/" target="_blank" rel="nofollow">沪ICP备2025110782号-1</a></div>
</div>



<div id="stats" class="icp"></div> <!-- Google tag (gtag.js) --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-1G7RNXMWQX"></script> <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-1G7RNXMWQX');
</script> <script async src="https://analytics.lyyyuna.com/v1/stats.js"></script>


</body>
</html>
