
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>lyyyuna 的小花园: How to use Ginkgo label in your test</title>
    
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  table {
      border-collapse: collapse;
      width: 100%;
  }
  th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
  }
  th {
      background-color: #f2f2f2;
  }
  
  .icp {
    margin: 10px 0;
    width: 100%;
    height: 36px;
    white-space: pre;
    text-align: center;
    color: gray;
    z-index: 1000;
  }
  body {
    padding: 0;
    margin: 0;
    font-size: 112.5%;
    font-family: serif;
  }
  @media print {
    img {page-break-inside: avoid;}
    div.nosplit {page-break-inside: avoid;}
  }
  img {
    width: 100%;
  }
  img.center {
    display: block;
    margin: 0 auto;
  }
  img.resizable {
    max-width: 100%;
    height: auto;
  }
  p code, li code {
    font-size: 14px;
    word-wrap: break-word;
    padding: 2px 4px;
    border-radius: 4px;
    margin: 0 2px;
    color: #1e6bb8;
    background-color: rgba(27,31,35,.05);
    font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;
    word-break: break-all;
  }
  strong {
    font-weight: bold;
    color: darkred;
  }
  .pad {
    padding-top: 1em;
    padding-bottom: 1em;
  }
  a.anchor, a.back, a.footnote {
    color: black !important;
    text-decoration: none !important;
  }
  a.back {
    font-size: 50%;
  }
  @media print {
    a.back {display: none;}
  }
  .header {
    height: 1.25em;
    background-color: #dff;
    margin: 0;
    padding: 0.1em 0.1em 0.2em;
    border-top: 1px solid black;
    border-bottom: 1px solid #8ff;
  }
  .header h3 {
    margin: 0;
    padding: 0 2em;
    display: inline-block;
    padding-right: 2em;
    font-style: italic;
    font-size: 90%;
  }
  .rss {
    float: right;
    padding-top: 0.2em;
    padding-right: 2em;
    display: none;
  }
  .toc {
    margin-top: 2em;
  }
  .toc-title {
    font-family: cursive, serif;
    font-style: italic;
    font-size: 300%;
    line-height: 83%;
  }
  .toc-subtitle {
    display: block;
    margin-bottom: 1em;
    font-size: 83%;
  }
  @media only screen and (max-width: 550px) { .toc-subtitle { display: none; } }
  .header h3 a {
    color: black;
  }
  .header h4 {
    margin: 0;
    padding: 0;
    display: inline-block;
    font-weight: normal;
    font-size: 83%;
  }
  @media only screen and (max-width: 550px) { .header h4 { display: none; } }
  .main {
    padding: 0 2em;
  }
  @media only screen and (max-width: 479px) { .article { font-size: 120%; } }
  .article h1 {
    text-align: center;
    font-size: 200%;
  }
  .copyright {
    font-size: 83%;
  }
  .subtitle {
      font-size: 65%;
  }
  .normal {
    text-align: center;
    font-size: medium;
    font-weight: normal;
  }
  .when {
    text-align: center;
    font-size: 100%;
    margin: 0;
    padding: 0;
  }
  .when p {
    margin: 0;
    padding: 0;
  }
  .article h2 {
    font-size: 125%;
    padding-top: 0.25em;
  }
  .article h3 {
    font-size: 100%;
  }
  .footer {
    margin-top: 10px;
    font-size: 83%;
    font-family: sans-serif;
  }
  .comments {
    margin-top: 2em;
    background-color: #ffe;
    border-top: 1px solid #aa4;
    border-left: 1px solid #aa4;
    border-right: 1px solid #aa4;
  }
  .comments-header {
    padding: 0 5px 0 5px;
  }
  .comments-header p {
    padding: 0;
    margin: 3px 0 0 0;
  }
  .comments-body {
    padding: 5px 5px 5px 5px;
  }
  #plus-comments {
    border-bottom: 1px dotted #ccc;
  }
  .plus-comment {
    width: 100%;
    font-size: 14px;
    border-top: 1px dotted #ccc;
  }
  .me {
    background-color: #eec;
  }
  .plus-comment ul {
    margin: 0;
    padding: 0;
    list-style: none;
    width: 100%;
    display: inline-block;
  }
  .comment-when {
    color:#999;
    width:auto;
    padding:0 5px;
  }
  .old {
    font-size: 83%;
  }
  .plus-comment ul li {
    display: inline-block;
    vertical-align: top;
    margin-top: 5px;
    margin-bottom: 5px;
    padding: 0;
  }
  .plus-icon {
    width: 45px;
  }
  .plus-img {
    float: left;
    margin: 4px 4px 4px 4px;
    width: 32px;
    height: 32px;
  }
  .plus-comment p {
    margin: 0;
    padding: 0;
  }
  .plus-clear {
    clear: left;
  }
  .toc-when {
    font-size: 83%;
    color: #999;
  }
  .toc {
    list-style: none;
  }
  .toc li {
    margin-bottom: 0.5em;
  }
  .toc-head {
    margin-bottom: 1em !important;
    font-size: 117%;
  }
  .toc-summary {
    margin-left: 2em;
  }
  .favorite {
    font-weight: bold;
  }
  .article p, .article ol {
    line-height: 144%;
  }
  sup, sub {
    vertical-align: baseline;
    position: relative;
    font-size: 83%;
  }
  sup {
    bottom: 1ex;
  }
  sub {
    top: 0.8ex;
  }

  .main {
    position: relative;
    margin: 0 auto;
    padding: 0;
    width: 900px;
  }
  @media only screen and (min-width: 768px) and (max-width: 959px) { .main { width: 708px; } }
  @media only screen and (min-width: 640px) and (max-width: 767px) { .main { width: 580px; } }
  @media only screen and (min-width: 480px) and (max-width: 639px) { .main { width: 420px; } }
  @media only screen and (max-width: 479px) { .main { width: 90%; } }

  .pager {display: flex;margin-bottom: 20px}
  .pager:last-of-type {margin-top: 50px;}

  .pager span, .pager   a {flex: 50%;line-height:50px;}
  .pager a {color: var(--pager-fg); padding: 0 10px; border-radius: 4px; border: 1px solid #ccc; text-decoration: none; }
  .pager a:hover{background: var(--pager-hover); border-color: #bbb;}
  .pager .prev {margin-right: 10px;}
  .pager a.prev:not(:empty):before{content: '« '}
  .pager a.next:not(:empty):after{content: ' »'}
  .pager .next {text-align: right;margin-left: 10px}

</style>
<link rel="stylesheet" href="/libs/highlight/styles/a11y-dark.min.css">
<script src="/libs/highlight/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
</head>
<body>
    
<div class="header">
  <h3><a href="/">lyyyuna 的小花园</a></h3>
  <h4>动静中之动,
    by <a href="https://www.lyyyuna.com/about/" rel="author">lyyyuna</a> </h4>
  <a class="rss" href="https://www.lyyyuna.com/feed.atom">RSS</a>
</div>

<div class="main">
  <div class="article">
    <h1>How to use Ginkgo label in your test
    
    <div class="subtitle">(<i><a href="/series/Ginkgo 使用笔记/">Ginkgo 使用笔记</a>, Part 5</i>)</div>
    </h1>
    <div class="normal">
      <div class="when">
        
          发表于 2025-04
          
      </div>
    </div>
    <h2>Abstract</h2>
<p>Many testing frameworks provide capabilities to group test cases, such as <code>pytest</code>'s <code>mark</code>, <code>Robot Framework</code>'s <code>tag</code>, and <code>TestNG</code>'s <code>groups</code>.</p>
<p>In <code>Ginkgo v1</code>, there was no such functionality, so we had to embed <code>labels</code> into string-based titles and use <code>--focus</code> to filter test cases. However, string-based implementations have drawbacks like potential conflicts, duplication, and lack of type safety, <code>Ginkgo v1</code> is inadequate for large-scale test suites.</p>
<p>In <code>Ginkgo v2</code>, the official solution <code>Label</code> is introduced, let's explore it together.</p>
<p>P.S. This article is based on <code>Ginkgo v2.13.2</code>.</p>
<h2>Basic Usage</h2>
<h3>Adding Labels to Test Cases</h3>
<p>Labels are defined using the <code>Label</code> decorator and can be applied to any node type:</p>
<pre><code class="language-go">Describe(&quot;Upload&quot;, Label(&quot;integration&quot;, &quot;storage&quot;), func() {
    It(&quot;Form upload&quot;, Label(&quot;network&quot;, &quot;slow&quot;, &quot;library storage&quot;), func() {
        // Final labels [integration, storage, network, slow, library storage]
    })

    Context(&quot;Chunked upload&quot;, Label(&quot;network&quot;, &quot;library storage&quot;), func() {
        It(&quot;1 chunk&quot;, Label(&quot;slow&quot;) func() {
            // Final labels [integration, storage, network, slow, library storage]
        })

        It(&quot;2 chunks&quot;, Label(&quot;quick&quot;, &quot;storage&quot;) func() {
            // Final labels [integration, storage, network, quick, library storage]
        })
    })

    DescribeTable(&quot;s3 protocol&quot;, Label(&quot;quick&quot;), func(count int) {
        
    },
        Entry(&quot;PUT upload&quot;, Label(&quot;local&quot;), 17), // Final labels [integration, storage, quick, local]
        Entry(&quot;COPY upload&quot;, 20), // Final labels [integration, storage, quick]
    )
})
</code></pre>
<p>Key points:</p>
<ol>
<li>Labels are just strings.</li>
<li>Child nodes inherit parent node labels (e.g., <code>It</code> inherits from <code>Context/Describe</code>).</li>
<li>Labels are automatically deduplicated.</li>
<li><code>Entry</code> can also have labels, they will not be treated as parameters.</li>
</ol>
<h3>Filtering</h3>
<p><code>Ginkgo v1</code> already supports filtering via <code>--focus-file</code>, <code>--skip-file</code> (by filename/line number) and <code>--focus</code>, <code>--skip</code> (by title regex). However, test cases written for testing environments versus production environments may be scattered across various directories, files, and different test structures. Additionally, regular expressions are not intuitive and can lead to cumbersome command-line syntax.</p>
<p>The new label-based filtering provides a more intuitive syntax, <code>Ginkgo v2</code> use <code>--label-filter=QUERY</code> with these rules:</p>
<ul>
<li><code>label1 &amp;&amp; label2</code>, both labels match</li>
<li><code>label1 || label2</code>, either label matches</li>
<li><code>!label1</code> excludes cases with this label</li>
<li><code>,</code> acts like <code>||</code></li>
<li><code>()</code> can group expressions (e.g., <code>label1 &amp;&amp; (label2 || label3)</code>)</li>
<li>case-sensitive</li>
<li>whitespace around labels is ignored.</li>
</ul>
<p>For instance, if we are testing a cloud storage product, we have 4 test cases:</p>
<ol>
<li>test case 1: product, local, cn-east-1, slow</li>
<li>test case 2: local, cn-east-1, ap-southeast-1</li>
<li>test case 3: local, ap-southeast-1</li>
<li>test case 4: product, slow</li>
</ol>
<p>where</p>
<ol>
<li>product indicates the test case can run in the production environment, while local indicates it can run in the testing environment.</li>
<li>cn-east-1 means the test case can run in the East China region, and ap-southeast-1 indicates it can run in the Southeast Asia region.</li>
<li>slow signifies the test case takes a long time to execute.</li>
</ol>
<p>If using the following filter expressions:</p>
<ol>
<li><code>product</code>: Selects all test cases that can run in the production environment. This would execute Case 1 and Case 4.</li>
<li><code>!local</code>: Selects test cases that cannot run in the testing environment. This would only execute Case 4.</li>
<li><code>product &amp;&amp; cn-east-1</code>: Selects test cases that run in the production environment in the East China region. This would execute only Case 1.</li>
<li><code>cn-east-1 || ap-southeast-1</code>: Selects test cases that can run in either the East China or Southeast Asia regions. This would execute Cases 1, 2, and 3.</li>
<li><code>!slow</code>: Excludes test cases that take a long time to execute. This would execute Cases 2 and 3.</li>
</ol>
<p>It becomes evident that the new filtering syntax is more intuitive, allowing users to quickly construct the desired test case combinations.</p>
<h3>Combined Usage</h3>
<p><code>Ginkgo v2</code> retains previous filtering mechanisms:</p>
<ol>
<li>If a test case is marked as <code>Pending</code>, it will never execute, regardless of other conditions.</li>
<li>If a test case calls the <code>Skip()</code> function, it will be skipped even if it matches the filter criteria.</li>
<li>If a test case is marked with <code>Focus</code>, only that test case will run (all others are excluded).</li>
<li>If multiple filters are used in the command line (<code>--label-filter</code>, <code>--focus-file/--skip-file</code>, or <code>--focus/--skip</code>), a test case must satisfy all conditions simultaneously to execute.</li>
</ol>
<h3>Test Reports</h3>
<p>Labels in Ginkgo's built-in <code>JUnit Report</code> are not standalone attributes but are appended to the test case title. For example:</p>
<pre><code>Kodo e2e Suite.[It] Test s3 Chunked upload [module=bucket, KODO-18044, unstable, id=c522c, id=be25c]
</code></pre>
<p>The section [xxx, yyy, zzz] following the title lists all labels associated with the test case.</p>
<h2>Advanced Usage</h2>
<h3>Composing Labels</h3>
<p><code>Ginkgo</code> provides the <code>Label()</code> function to define the <code>Labels</code> type, with the following relationship:</p>
<pre><code class="language-go">func Label(labels ...string) Labels {
	return Labels(labels)
}

type Labels = internal.Labels
</code></pre>
<p>While the default <code>Label()</code> function works for basic use cases, it lacks flexibility for complex scenarios. For example, when testing a cloud storage product with four regions:</p>
<ol>
<li>cn-east-1 (East China)</li>
<li>cn-north-1 (North China)</li>
<li>cn-northwest-1 (Northwest China)</li>
<li>ap-southeast-2 (Southeast Asia)</li>
</ol>
<p>You might define labels to indicate which regions a test case can run in:</p>
<pre><code class="language-go">var ZCnEast1 = Label(&quot;cn-east-1&quot;)

var ZCnNorth1 = Label(&quot;cn-north-1&quot;)

var ZCnNorthWest1 = Label(&quot;cn-northwest-1&quot;)

var ZApSouthEast2 = Label(&quot;ap-southeast-2&quot;)
</code></pre>
<p>However, manually adding all 4 labels to each test case can become cumbersome. To address this, you can define a composite label like ZAll to represent <strong>it can be run in all regions</strong>:</p>
<pre><code class="language-go">var ZAll = Label(&quot;cn-east-1&quot;, &quot;cn-north-1&quot;, &quot;cn-northwest-1&quot;, &quot;ap-southeast-2&quot;)
</code></pre>
<p>To avoid string-based errors and enhance flexibility, you can create helper functions to combine or modify labels:</p>
<pre><code class="language-go">func combine(labels ...Labels) Labels {
	mapl := make(map[string]bool)

	for _, ls := range labels {
		for _, l := range ls {
			mapl[l] = true
		}
	}

	out := make([]string, 0)
	for k := range mapl {
		out = append(out, k)
	}

	return Label(out...)
}

// all region
var ZAll = combine(ZCnEast1, ZCnNorth1, ZCnNorthWest1, ZApSouthEast2)
</code></pre>
<p>Similarly, if a test case cannot run in the <code>ap-southeast-2</code> (Southeast Asia region), you can define a <code>remove(Labels, ...Labels) Labels</code> function to exclude specific labels:</p>
<pre><code class="language-go">func remove(all Labels, remove ...Labels) Labels {
	labelNeedsDel := make(map[string]bool)

	for _, labels2 := range remove {
		for _, l := range labels2 {
			labelNeedsDel[l] = true
		}
	}

	out := make([]string, 0)
	for _, l := range all {
		if _, ok := labelNeedsDel[l]; !ok {
			out = append(out, l)
		}
	}

	return Label(out...)
}

// can only run in China
var ZChina = remove(ZAll, ZApSouthEast2)
</code></pre>
<h3>Automatic Filtering</h3>
<h4>Configuration File-Based Filtering</h4>
<p>Many applications use configuration files to define environment-specific settings (e.g., production, staging, or local environments). You can automatically apply label filters based on these configurations.</p>
<p>Modify the Ginkgo entry function to inject labels dynamically:</p>
<pre><code class="language-go">func TestE2E(t *testing.T) {  
    RegisterFailHandler(Fail)  

    // Retrieve current configuration  
    suiteConfig, reportConfig := GinkgoConfiguration()  

    // Add &quot;product&quot; label filter (combined with existing filters via logical AND)  
    suiteConfig.LabelFilter = fmt.Sprintf(&quot;(%v) &amp;&amp; (%v)&quot;,  
        suiteConfig.LabelFilter,  
        &quot;product&quot;,  
    )  

    // Run tests with updated configuration  
    RunSpecs(t, &quot;e2e Suite&quot;, suiteConfig, reportConfig)  
}  
</code></pre>
<p>Explanation:</p>
<ol>
<li>The <code>product</code> label is automatically added to <code>--label-filter</code>, ensuring only production-ready test cases run by default.</li>
<li>Existing command-line filters (e.g., <code>--label-filter=region=us-east-1</code>) are preserved via the logical <code>AND</code> relationship.</li>
</ol>
<h4>Manually Filering</h4>
<p>Some test cases cannot be fully automated and require manual execution (e.g., UI validation or human-in-the-loop steps). In <code>Ginkgo v1</code>, these cases had to be manually commented/uncommented by <code>Skip()</code>. With labels, you can define a <code>manual</code> label, and exclude it in Ginkgo entry point:</p>
<pre><code class="language-go">var Manual = Label(&quot;manual&quot;)  

func TestE2E(t *testing.T) {  
    RegisterFailHandler(Fail)  

    suiteConfig, reportConfig := GinkgoConfiguration()  

    // Automatically exclude manual tests unless explicitly included  
    if !strings.Contains(suiteConfig.LabelFilter, &quot;manual&quot;) {  
        suiteConfig.LabelFilter += &quot; &amp;&amp; (!manual)&quot;  
    }  

    RunSpecs(t, &quot;e2e Suite&quot;, suiteConfig, reportConfig)  
}  
</code></pre>
<p>Behavior:</p>
<ol>
<li><strong>Default</strong>: All tests with the <code>manual</code> label are skipped (due to <code>!manual</code>).</li>
<li><strong>Override</strong>: Run manual tests by adding <code>--label-filter=manual</code> to the command line.</li>
</ol>

  </div>

    
    <div class="pager">

      
        <a class="prev" href="/2023/12/29/ginkgo-concurrency-test/">
          Ginkgo 并发测试教程
        </a>
      

      

    </div>
    
  <div class="icp"> lyyyuna <a href="https://beian.miit.gov.cn/" target="_blank" rel="nofollow">沪ICP备2025110782号-1</a></div>
</div>



<div id="stats" class="icp"></div> <!-- Google tag (gtag.js) --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-1G7RNXMWQX"></script> <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-1G7RNXMWQX');
</script> <script async src="https://analytics.lyyyuna.com/v1/stats.js"></script>


</body>
</html>
